{% assign timer_id = "dtimer-" | append_random %}

<script>
  // Segment mappings for each digit (0-9 and a-z)
  const segmentMap = {
    '0': [1,2,5,6,9,10,13,14],
    '1': [6,13],
    '2': [1,6,7,8,9,14],
    '3': [1,6,7,8,13,14],
    '4': [2,6,7,8,13],
    '5': [1,2,7,8,13,14],
    '6': [1,2,7,8,9,13,14],
    '7': [1,6,13],
    '8': [1,2,6,7,8,9,13,14],
    '9': [1,2,6,7,8,13,14],
    'a': [1,2,6,7,8,9,13],
    'b': [1,4,6,7,8,11,13,14],
    'c': [1,2,9,14],
    'd': [1,4,6,11,13,14],
    'e': [1,2,7,9,14],
    'f': [1,2,7,9],
    'g': [1,2,8,9,13,14],
    'h': [2,6,7,8,9,13],
    'i': [1,4,11,14],
    'j': [6,9,13,14],
    'k': [2,5,7,9,12],
    'l': [2,9,14],
    'm': [2,3,5,6,9,13],
    'n': [2,3,6,9,12,13],
    'o': [1,2,6,9,13,14],
    'p': [1,2,6,7,8,9],
    'q': [1,2,6,9,12,13,14],
    'r': [1,2,6,7,8,9,12],
    's': [1,2,7,8,13,14],
    't': [1,4,11],
    'u': [2,6,9,13,14],
    'v': [2,5,9,10],
    'w': [2,6,9,10,12,13],
    'x': [3,5,10,12],
    'y': [3,6,8,13,14],
    'z': [1,5,10,14],
    'Â°': [4,6,8]
  };
  // SVG path data for each segment (1-14)
  const segmentPaths = {
    1: "M43.773 0L45.1519 1.55806L44.4051 2.19283C44.3283 2.30824 44.2327 2.40442 44.1177 2.48136C44.1177 2.51983 44.0986 2.53906 44.0604 2.53906L43.1413 3.34694C43.1027 3.42388 43.0454 3.50084 42.9689 3.57778C42.9307 3.57778 42.8922 3.59701 42.8539 3.63548L41.8201 4.55877V4.61648L41.6477 4.78958C41.6477 4.78958 41.6477 4.77035 41.6477 4.73188L40.1539 6.11683H38.6604C38.6222 6.11683 38.5839 6.13606 38.5457 6.17453H37.9713C37.9713 6.17453 37.9713 6.15529 37.9713 6.11683H36.1904C36.1904 6.11683 36.1713 6.13606 36.133 6.17453H35.5583C35.5583 6.17453 35.5392 6.15529 35.501 6.11683H33.7201C33.7201 6.15529 33.701 6.17453 33.6627 6.17453H33.0883V6.11683H31.3075L31.2501 6.17453H30.6757C30.6757 6.17453 30.6757 6.15529 30.6757 6.11683H28.8949C28.8566 6.15529 28.8183 6.17453 28.78 6.17453H28.2055C28.2055 6.17453 28.2055 6.15529 28.2055 6.11683H26.4247L26.3673 6.17453H25.7928C25.7928 6.17453 25.7928 6.15529 25.7928 6.11683H24.012C23.9737 6.11683 23.9546 6.13606 23.9546 6.17453H23.3227C23.3227 6.17453 23.3227 6.15529 23.3227 6.11683H21.5419C21.5419 6.15529 21.5228 6.17453 21.4845 6.17453H20.91C20.91 6.17453 20.91 6.15529 20.91 6.11683H19.0718C19.0718 6.15529 19.0526 6.17453 19.0143 6.17453H18.4399V6.11683H16.6591L16.6017 6.17453H16.0272V6.11683H14.2464C14.2464 6.11683 14.2273 6.13606 14.189 6.17453H13.5571V6.11683H12.6954L8.55936 1.55806L10.2253 0H43.773Z",
    2: "M11.0294 7.6749L10.6273 11.9451V12.1759C10.589 12.3298 10.5699 12.4837 10.5699 12.6376C10.5699 12.6376 10.5507 12.6376 10.5124 12.6376L10.3975 14.4265C10.3592 14.5419 10.3401 14.6573 10.3401 14.7727V15.0613C10.3401 15.0613 10.3209 15.0805 10.2826 15.119L10.1677 16.8501V17.0233C10.1294 17.1002 10.1103 17.1964 10.1103 17.3118C10.1103 17.3887 10.0911 17.4464 10.0529 17.4849L9.47844 23.7749L9.30609 25.4483H9.36353C9.32524 25.5637 9.30609 25.7176 9.30609 25.91C9.30609 25.9869 9.28694 26.0638 9.24865 26.1408L9.13376 27.5835L5.80197 30.6419L3.04462 27.5835L5.2275 4.61648L6.89341 3.05843L11.0294 7.6749Z",
    3: "M20.5079 19.9086L20.3356 21.7551H20.393C20.3547 21.8705 20.3356 22.0052 20.3356 22.1591C20.3356 22.236 20.3164 22.3322 20.2781 22.4476L20.1058 24.1788V24.8713H20.0484L19.9335 26.0254H19.1292V26.0831H18.5548V26.0254H18.4399L11.6614 16.8501L12.4082 9.17525L20.5079 19.9086Z",
    4: "M29.0094 10.7342L28.7797 13.1578V13.7349C28.7797 13.7734 28.7605 13.8119 28.7222 13.8503L28.5499 15.6969V16.1586C28.5116 16.197 28.4924 16.2547 28.4924 16.3317L28.3201 18.0629C28.3584 18.1013 28.3584 18.1783 28.3201 18.2937C28.2818 18.3706 28.2627 18.4668 28.2627 18.5822V18.7554L27.6882 24.7568V24.9299L27.5159 26.6611V26.8919C27.4776 27.0458 27.4584 27.1996 27.4584 27.3535L27.401 27.5844L26.4819 28.45C26.4819 28.4884 26.4627 28.5269 26.4244 28.5654H26.3095L25.2755 29.5464C25.2755 29.5464 25.2564 29.5656 25.2181 29.604C25.2181 29.7195 25.1415 29.7963 24.9883 29.835L24.0692 30.6428L21.3118 27.5844L22.9203 10.7342L26.2521 7.67578L29.0094 10.7342Z",
    5: "M39.8095 9.46376C39.8095 9.65613 39.7901 9.86771 39.7519 10.0985V10.214L39.5795 11.9451V12.1182C39.5795 12.2337 39.5604 12.3683 39.5222 12.5222L39.3498 14.3688V15.0035C39.3116 15.0035 39.2925 15.0228 39.2925 15.0613L39.1201 16.8501L35.7307 20.5433L35.501 20.7741V20.7164L34.5819 21.7551C34.5054 21.8705 34.4095 21.986 34.2948 22.1014C34.2948 22.1014 34.2948 22.0822 34.2948 22.0437L33.433 23.0247H33.4904C33.4139 23.0632 33.3372 23.1209 33.2607 23.1978C33.2607 23.1978 33.2416 23.217 33.2033 23.2555L31.1927 25.4483C31.1542 25.5253 31.0969 25.583 31.0204 25.6215C30.9054 25.7753 30.7907 25.91 30.6757 26.0254H29.0672L29.6992 19.9086L39.8669 9.17525L39.8095 9.46376Z",
    6: "M47.9091 4.61648L47.7941 5.88602C47.7941 6.07836 47.775 6.27073 47.7368 6.46307L47.2197 11.9451C47.2197 12.1375 47.2006 12.3683 47.1624 12.6376L46.99 14.4265V14.5996C46.9515 14.7535 46.9324 14.9074 46.9324 15.0613V15.119L46.76 16.8501C46.7218 16.9656 46.7218 17.081 46.76 17.1964C46.76 17.2733 46.7409 17.3695 46.7026 17.4849L46.0709 23.7749L45.9559 25.4483C45.9559 25.5253 45.9368 25.6215 45.8985 25.7369V26.1408H45.8409L45.7262 27.5835L42.3944 30.6419L39.6371 27.5835L41.5326 7.6749L46.5303 3.05843L47.9091 4.61648Z",
    7: "M19.6461 29.0847L22.4035 32.1431V32.2586H22.2886L21.5418 32.9509C21.3886 33.1819 21.1971 33.3551 20.9674 33.4703L20.3355 34.0473C20.2206 34.2397 19.9716 34.4707 19.5887 34.7399L19.0717 35.2593H9.938L7.18065 32.1431L10.5124 29.0847H19.6461Z",
    8: "M37.9712 29.0838L40.7285 32.1422L37.3965 35.2584H28.2054L25.4481 32.1422L28.7799 29.0838H37.9712Z",
    9: "M8.27206 36.7592L8.21462 37.1631C8.21462 37.1631 8.21462 37.1823 8.21462 37.221L8.04229 38.8944C8.04229 39.1252 8.02312 39.3559 7.98482 39.5867L7.8125 41.3757C7.8125 41.6064 7.79335 41.8375 7.75506 42.0682L7.58271 43.7993V44.03C7.58271 44.1071 7.56356 44.184 7.52526 44.2611V44.4918L6.95082 50.4355V50.6662L6.7785 52.3976V52.5707C6.74021 52.7247 6.72106 52.8975 6.72106 53.0901L6.54871 54.8212V55.1096C6.51041 55.2635 6.49126 55.3982 6.49126 55.5138L6.37638 56.6678L2.18291 60.5341L1.37868 61.2843L0 59.726L2.12546 36.7592L5.51471 33.7006L8.27206 36.7592Z",
    10: "M18.7844 38.3162L18.612 40.1049V40.3357C18.612 40.4513 18.5929 40.586 18.5546 40.7399V40.7975L18.2099 44.4331L18.0376 44.6062L8.04223 55.1664L8.73156 47.4914L17.2334 38.3162H18.7844Z",
    11: "M26.5394 36.7591L26.482 37.6824V38.0287C26.4437 38.1442 26.4245 38.2594 26.4245 38.3749L26.2522 40.1639C26.2139 40.3562 26.1948 40.5678 26.1948 40.7985V40.8562L26.0224 42.5875V42.7027C26.0224 42.8183 26.0033 42.9335 25.965 43.049V43.2221L25.1608 51.1855H25.2182C25.1799 51.3395 25.1608 51.4934 25.1608 51.6473V51.8205C25.1608 51.8205 25.1416 51.8205 25.1033 51.8205V51.8781L24.931 53.6092L23.6097 54.8211C23.5714 54.8979 23.5331 54.9558 23.4948 54.9942C23.4565 55.0711 23.3991 55.129 23.3225 55.1674C23.3225 55.1674 23.3225 55.1482 23.3225 55.1095L22.2885 56.0907H22.346L22.231 56.2059C22.1928 56.2059 22.1545 56.2251 22.1162 56.2638C22.1162 56.2638 22.1162 56.2446 22.1162 56.2059L21.5992 56.6677L18.8418 53.6092L20.4503 36.7591L23.7821 33.7005L26.5394 36.7591Z",
    12: "M29.4689 38.316L36.1901 47.4911V48.1836H36.1327L35.9604 49.9726H36.0177C36.0177 50.011 35.9986 50.0494 35.9604 50.0878V50.5496C35.9604 50.5496 35.9413 50.5688 35.9027 50.6072L35.7304 52.3962H35.788C35.7495 52.4346 35.7304 52.473 35.7304 52.5114V53.0887H35.673L35.5007 55.1661L27.3436 44.4328L27.918 38.316H29.4689Z",
    13: "M44.8645 36.7589L44.6348 38.8941H44.6922C44.6539 39.1249 44.6348 39.3556 44.6348 39.5864H44.5772L44.4051 41.433V41.8948C44.4051 41.9332 44.3857 41.9908 44.3475 42.0679L44.1751 43.799C44.2136 43.799 44.2136 43.8182 44.1751 43.8569V44.2608C44.1369 44.3376 44.1177 44.4147 44.1177 44.4915L43.5433 50.4928V50.6659L43.371 52.3973C43.371 52.628 43.3519 52.8588 43.3136 53.0898L43.1413 54.8209V55.0517C43.1413 55.2056 43.1222 55.3595 43.0836 55.5135L42.9113 57.36C42.9113 57.5908 42.8922 57.8215 42.8539 58.0523L42.6816 59.7257L41.0157 61.284L36.8798 56.6675L38.7754 36.7589L42.1072 33.7003L44.8645 36.7589Z",
    14: "M35.2138 58.2248L39.3497 62.7837L37.6838 64.3416H4.13603L2.75735 62.7837L7.75506 58.2248H35.2138Z"
  };

  function renderDigit(digit, width = 30) {
    const digitStr = String(digit);
    const activeSegments = segmentMap[digitStr] || [];
    
    let paths = '';
    for (let i = 1; i <= 14; i++) {
      const isActive = activeSegments.includes(i);
      const className = isActive ? 'number-on' : 'number-off';
      paths += `<path class="${className}" d="${segmentPaths[i]}"/>`;
    }
    
    return `<svg width="${width}px" class="image-dither" viewBox="0 0 50 65" fill="none" xmlns="http://www.w3.org/2000/svg">${paths}</svg>`;
  }
</script>

{% assign utc_offset_seconds = trmnl.user.utc_offset | default: 0 %}
{% assign utc_offset_hours = utc_offset_seconds | divided_by: 3600 %}
{% assign color_mode = trmnl.plugin_settings.custom_fields_values.color_mode | default: "dark" %}

{% assign hours_utc = "now" | date: "%H" | plus: 0 %}
{% assign minutes = "now" | date: "%M" %}
{% assign day = "now" | date: "%d" %}
{% assign month = "now" | date: "%b" | upcase %}
{% assign year = "now" | date: "%Y" %}

{% assign hours_local = hours_utc | plus: utc_offset_hours %}

{% if hours_local < 0 %}
  {% assign hours_local = hours_local | plus: 24 %}
{% elsif hours_local >= 24 %}
  {% assign hours_local = hours_local | minus: 24 %}
{% endif %}

{% if hours_local < 10 %}
  {% assign hours = "0" | append: hours_local %}
{% else %}
  {% assign hours = hours_local | append: "" %}
{% endif %}

{% assign location = trmnl.plugin_settings.custom_fields_values.location | default: "" %}
{% assign time_format = trmnl.plugin_settings.custom_fields_values.time_format | default: "24h" %}
{% assign date_format = trmnl.plugin_settings.custom_fields_values.date_format | default: "eu" %}

{% if time_format == "12h" %}
  {% assign hours_num = hours | plus: 0 %}
  {% if hours_num == 0 %}
    {% assign hours = "12" %}
    {% assign am_pm = "am" %}
  {% elsif hours_num < 12 %}
    {% if hours_num < 10 %}
      {% assign hours = "0" | append: hours_num %}
    {% else %}
      {% assign hours = hours_num | append: "" %}
    {% endif %}
    {% assign am_pm = "am" %}
  {% elsif hours_num == 12 %}
    {% assign hours = "12" %}
    {% assign am_pm = "pm" %}
  {% else %}
    {% assign hours_12 = hours_num | minus: 12 %}
    {% if hours_12 < 10 %}
      {% assign hours = "0" | append: hours_12 %}
    {% else %}
      {% assign hours = hours_12 | append: "" %}
    {% endif %}
    {% assign am_pm = "pm" %}
  {% endif %}
{% else %}
  {% assign am_pm = "" %}
{% endif %}

{% if date_format == "us" %}
  {% comment %} US format: MMM DD, YYYY {% endcomment %}
  {% assign date_string = month | append: " " | append: day | append: " " | append: year %}
{% else %}
  {% comment %} EU format: DD MMM YYYY (default) {% endcomment %}
  {% assign date_string = day | append: " " | append: month | append: " " | append: year %}
{% endif %}


<style>
  .dark .number-on {
    fill: #FFFFFF;
  }
  
  .dark .number-off {
    fill: #232323;
  }

  .light .number-on {
    fill: #000000;
  }
  
  .light .number-off {
    fill: #D9D9D9;
  }
</style>